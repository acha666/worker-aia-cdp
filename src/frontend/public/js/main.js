async function Z(e,n){const t=await fetch(e);if(!t.ok)throw new Error(`${n} failed: ${t.status}`);const r=await t.json();if(r?.error)throw new Error(r.error.message||`${n} failed`);return r.data}async function H(e){return Z(`/api/v1/collections/${e}/items`,`list ${e}`)}async function le(e){const n=encodeURIComponent(e);return Z(`/api/v1/objects/${n}/metadata`,"metadata")}const ae=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function oe(e){const n=-e.getTimezoneOffset();if(n===0)return"UTC";const t=n>0?"+":"-",r=Math.abs(n),i=Math.floor(r/60),s=r%60,l=String(i);return s===0?`UTC${t}${l}`:`UTC${t}${l}:${String(s).padStart(2,"0")}`}function N(e,n={}){if(!e)return null;const t=E(e,null,null,n);return t?t.timezone?`${t.baseText} ${t.timezone}`:t.baseText:typeof e=="string"?e:String(e)}function E(e,n,t,r={}){if(!e)return null;const i=new Date(e);if(Number.isNaN(i.getTime()))return null;const{precision:s="second"}=r,l=ae[i.getMonth()]??"Jan",a=String(i.getDate()).padStart(2,"0"),o=i.getFullYear(),c=[`${l} ${a} ${o}`];if(s!=="day"){const x=String(i.getHours()).padStart(2,"0"),d=String(i.getMinutes()).padStart(2,"0");if(s==="minute")c.push(`${x}:${d}`);else{const y=String(i.getSeconds()).padStart(2,"0");c.push(`${x}:${d}:${y}`)}}const u=c.join(" "),p=oe(i),m=typeof t=="number"&&Number.isFinite(t)?t:null,b=typeof n=="number"&&Number.isFinite(n)?n:null,g=m!==null&&Math.abs(m)<86400;let h=null;return g&&(h=w(m)),!h&&(b!==null||m!==null)&&(h=Q(b)??w(m)),{baseText:u,timezone:p,relativeText:h}}function Q(e){if(typeof e!="number"||!Number.isFinite(e))return null;const n=Math.round(e);if(n===0)return"today";const t=Math.abs(n)===1?"day":"days";return n>0?`in ${n} ${t}`:`${Math.abs(n)} ${t} ago`}function w(e){if(typeof e!="number"||!Number.isFinite(e))return null;const n=Math.abs(e),t=e>=0?1:-1;if(n<86400){if(n===0)return"now";const i=Math.max(1,Math.round(n/60));let s=Math.floor(i/60),l=i%60;s===0&&l===0&&(l=1),s>0&&l===60&&(s+=1,l=0);const a=[];return s>0&&a.push(`${s}h`),(l>0||a.length===0)&&a.push(`${l}m`),t>=0?`in ${a.join(" ")}`:`${a.join(" ")} ago`}const r=[{label:"day",value:86400},{label:"hour",value:3600},{label:"minute",value:60},{label:"second",value:1}];for(const i of r)if(n>=i.value||i.label==="second"){const s=Math.round(n/i.value),l=s===1?"":"s";return t>=0?`in ${s} ${i.label}${l}`:`${s} ${i.label}${l} ago`}return null}function z(e){if(e==null)return null;if(typeof e=="number"&&Number.isFinite(e))return e.toLocaleString("en-US");const n=Number(e);return!Number.isNaN(n)&&Number.isFinite(n)?n.toLocaleString("en-US"):typeof e=="string"?e:String(e)}function ce(e){if(typeof e!="number"||!Number.isFinite(e))return null;const n=["B","KB","MB","GB","TB"];let t=e,r=0;for(;t>=1024&&r<n.length-1;)t/=1024,r++;const i=r===0?0:t>=10?1:2;return`${t.toFixed(i)} ${n[r]}`}function I(e){if(!e)return null;const n=[];return e.name&&n.push(e.name),e.oid&&e.oid!==e.name&&n.push(`(${e.oid})`),n.join(" ")}function A(e="—"){const n=document.createElement("span");return n.className="detail-muted",n.textContent=e,n}function ee(e){if(e==null)return null;const n=typeof e=="string"?e:String(e);if(!n)return null;const t=document.createElement("span");return t.className="detail-inline-pair__value detail-inline-pair__value--mono",t.textContent=n,t}function $(e){if(!e)return null;const n=typeof e=="string"?e.replace(/[^0-9a-f]/gi,""):"";return n?(n.match(/.{1,2}/g)||[]).join(":"):null}function J(e){if(!e)return"";const t=e.replace(/[^0-9a-f]/gi,"").toLowerCase().match(/.{1,2}/g)||[];return t.length===0?"":t.join(":")}function ue(e,n=8){if(!e)return"";const r=e.replace(/[^0-9a-f]/gi,"").toLowerCase().match(/.{1,2}/g)||[];if(r.length===0)return"";const i=r.slice(0,n).join(":");return r.length>n?`${i}:…`:i}function S(e,n={}){if(!e)return A();const t=typeof e=="string"?e.replace(/[^0-9a-f]/gi,"").toLowerCase():"";if(!t)return A();const r=n.threshold??96;if(t.length<=r){const c=document.createElement("code");return c.className="hex-inline",c.textContent=J(t),c}const i=document.createElement("details");i.className="hex-toggle";const s=document.createElement("summary"),l=[];n.summary&&l.push(n.summary),n.bitLength&&l.push(`${n.bitLength} bits`);const a=ue(t,n.previewBytes??12);a&&l.push(a),l.length===0&&l.push("Show hex"),s.textContent=l.join(" • "),i.append(s);const o=document.createElement("pre");return o.className="hex-content",o.textContent=J(t),i.append(o),i}function U(e,n){if(e==null)return n?null:A();if(e instanceof Node)return e;if(Array.isArray(e)){const r=e.filter(s=>s!=null&&s!=="");if(r.length===0)return n?null:A();const i=document.createElement("ul");i.className="detail-list";for(const s of r){const l=document.createElement("li");s instanceof Node?l.append(s):typeof s=="string"?l.textContent=s:l.textContent=String(s),i.append(l)}return i}if(typeof e=="string"){if(e.length===0)return n?null:A();const r=document.createElement("span");return r.textContent=e,r}if(typeof e=="number"){const r=document.createElement("span");return r.textContent=z(e),r}const t=document.createElement("span");return t.textContent=String(e),t}function v(e,n){if(!Array.isArray(n)||n.length===0)return null;const t=document.createElement("div");if(t.className="detail-section",e){const s=document.createElement("h3");s.textContent=e,t.append(s)}const r=document.createElement("dl");r.className="detail-grid";let i=!1;for(const s of n){if(!s||!s.label)continue;const l=U(s.value,s.skipEmpty);if(!l)continue;const a=document.createElement("dt");a.textContent=s.label;const o=document.createElement("dd");o.append(l),r.append(a,o),i=!0}return i?(t.append(r),t):null}function D(e,n={}){if(!Array.isArray(e)||e.length===0)return null;const t=e.map(i=>{if(!i)return null;const s=i.label??null,l=i.value??null;return!s||l==null||l===""?null:{label:String(s).trim(),value:l,valueClass:i.valueClass??null}}).filter(Boolean);if(!t.length)return null;const r=document.createElement("div");return r.className="detail-inline-pairs",t.forEach(i=>{const s=document.createElement("div");s.className="detail-inline-pair";const l=document.createElement("span");l.className="detail-inline-pair__label";const a=i.label.endsWith(":")?i.label:`${i.label}:`;l.textContent=a;const o=document.createElement("span");o.className="detail-inline-pair__value",n.valueClass&&o.classList.add(n.valueClass),i.valueClass&&o.classList.add(i.valueClass),i.value instanceof Node?o.append(i.value):o.textContent=typeof i.value=="string"?i.value:String(i.value),s.append(l,o),r.append(s)}),r}function de(e){if(!e)return null;let n=null;if(typeof e=="string"?n=e.replace(/^0x/i,""):typeof e=="object"&&(typeof e.hex=="string"?n=e.hex.replace(/^0x/i,""):typeof e.value=="string"&&(n=e.value.replace(/^0x/i,""))),!n)return null;const t=[];try{const r=BigInt(`0x${n}`).toString(10);t.push({label:"Decimal",value:r,valueClass:"detail-inline-pair__value--mono"})}catch(r){console.warn("serial decimal conversion failed",r)}return t.push({label:"Hex",value:`0x${n.toUpperCase()}`,valueClass:"detail-inline-pair__value--mono"}),D(t)}function _(e,n,t,r={}){const i=E(e,n,t,r);if(!i)return N(e,r);const s=[i.baseText];i.timezone&&s.push(i.timezone);let l=s.join(" ");return i.relativeText&&(l+=` (${i.relativeText})`),l}function te(e,n){const t=typeof n=="number"&&Number.isFinite(n)?n:null,r=typeof e=="number"&&Number.isFinite(e)?e:null;if(t!==null&&Math.abs(t)<86400){const s=w(t);if(s)return s}return Q(r)??w(t)}function k(e){if(!e)return{secondsUntil:null,daysUntil:null,isExpired:null};const n=new Date(e);if(Number.isNaN(n.getTime()))return{secondsUntil:null,daysUntil:null,isExpired:null};const t=n.getTime()-Date.now(),r=Math.floor(t/1e3),i=Math.floor(r/86400);return{secondsUntil:r,daysUntil:i,isExpired:t<0}}function R(e,{category:n="status",tone:t="neutral"}={}){if(!e)return null;const r=document.createElement("span"),i=n.replace(/[^a-z0-9-]/gi,"").toLowerCase()||"status",s=t.replace(/[^a-z0-9-]/gi,"").toLowerCase()||"neutral";return r.className=`detail-chip detail-chip--${i} detail-chip--${i}-${s}`,r.textContent=e,r}function B(e,n={}){if(!e||typeof e.isExpired!="boolean")return null;const{soonThresholdDays:t=30}=n,r=te(e.daysUntil,e.secondsUntil);return e.isExpired?{label:"Expired",variant:"danger",description:r??"Expired"}:typeof e.daysUntil=="number"&&Number.isFinite(e.daysUntil)&&e.daysUntil<=t?{label:"Expiring soon",variant:"warning",description:r??null}:{label:"Active",variant:"success",description:r??null}}function K(e,n,t={}){if(!e||typeof e.isExpired!="boolean")return null;const r=7200,i=typeof t.warningThresholdSeconds=="number"&&Number.isFinite(t.warningThresholdSeconds)?Math.max(0,t.warningThresholdSeconds):null,s=typeof t.warningThresholdDays=="number"&&Number.isFinite(t.warningThresholdDays)?t.warningThresholdDays:null,l=i??(s!==null?Math.max(0,s*86400):r),a=te(e.daysUntil,e.secondsUntil);if(e.isExpired)return{label:"Stale",variant:"danger",description:a??"Next update overdue"};const o=typeof e.secondsUntil=="number"&&Number.isFinite(e.secondsUntil)?e.secondsUntil:null;return o!==null&&o<=l?{label:"Updating soon",variant:"warning",description:a??null}:o===null&&typeof e.daysUntil=="number"&&Number.isFinite(e.daysUntil)&&e.daysUntil<=l/86400?{label:"Updating soon",variant:"warning",description:a??null}:{label:n?"Delta current":"Current",variant:"success",description:a??null}}function T(e,{detailed:n=!1}={}){if(!e)return null;if(!n)return R(e.label,{category:"status",tone:e.variant??"neutral"});const t=document.createElement("div");t.className="detail-status";const r=R(e.label,{category:"status",tone:e.variant??"neutral"});if(r&&t.append(r),e.description){const i=document.createElement("span");i.className="detail-status__note",i.textContent=e.description,t.append(i)}return t.childElementCount?t:r}function j(e,n){if(!e||n==null||n==="")return null;const t=document.createElement("div");t.className="detail-metric";const r=document.createElement("span");r.className="detail-metric__label",r.textContent=e,t.append(r);const i=document.createElement("span");return i.className="detail-metric__value",n instanceof Node?i.append(n):i.textContent=typeof n=="string"?n:String(n),t.append(i),t}function fe(e){if(!e||typeof e!="object")return null;const n=e.attributes??{},t=[];if(typeof n.size=="number"&&Number.isFinite(n.size)){const i=ce(n.size),s=z(n.size),l=i?`${i} (${s} bytes)`:`${s} bytes`,a=j("Size",l);a&&t.push(a)}else if(n.size!==null&&n.size!==void 0){const i=j("Size",String(n.size));i&&t.push(i)}if(n.uploadedAt){const i=N(n.uploadedAt),s=(new Date(n.uploadedAt).getTime()-Date.now())/1e3,l=w(s),a=j("Uploaded",l?`${i} (${l})`:i);a&&t.push(a)}if(n.etag){const i=j("ETag",n.etag);i&&t.push(i)}if(!t.length)return null;const r=document.createElement("div");return r.className="detail-metrics",t.forEach(i=>r.append(i)),r}function me(e){if(!e)return null;const n=[`CA: ${e.isCA?"TRUE":"FALSE"}`];return e.pathLenConstraint!==null&&e.pathLenConstraint!==void 0&&n.push(`pathLenConstraint: ${e.pathLenConstraint}`),n}function pe(e){if(!e)return null;if(Array.isArray(e))return e.length?e:null;if(typeof e!="object")return null;const n={digitalSignature:"Digital Signature",nonRepudiation:"Non Repudiation",keyEncipherment:"Key Encipherment",dataEncipherment:"Data Encipherment",keyAgreement:"Key Agreement",keyCertSign:"Certificate Signing",cRLSign:"CRL Signing",encipherOnly:"Encipher Only",decipherOnly:"Decipher Only"},r=(Array.isArray(e.enabled)?e.enabled:Object.entries(e.flags??{}).filter(([,i])=>!!i).map(([i])=>i)).map(i=>n[i]??i);return r.length?r:null}function he(e){if(!e)return null;if(Array.isArray(e))return e.length?e:null;const n=[];return Array.isArray(e.usages)&&e.usages.length&&n.push(`usages: ${e.usages.join(", ")}`),Array.isArray(e.oids)&&e.oids.length&&n.push(`oids: ${e.oids.join(", ")}`),Array.isArray(e.other)&&e.other.length&&n.push(...e.other.map(t=>`${t.oid??"other"}${t.value?`: ${t.value}`:""}`.trim())),n.length?n:null}function be(e){if(!e)return null;if(Array.isArray(e))return e.length?e:null;const n=[],t=(r,i)=>{Array.isArray(i)&&i.length&&n.push(`${r}: ${i.join(", ")}`)};return t("DNS",e.dnsNames),t("Email",e.emailAddresses),t("IP",e.ipAddresses),t("URI",e.uris),Array.isArray(e.directoryNames)&&e.directoryNames.length&&n.push(...e.directoryNames.map(r=>`DirName: ${r.dn??r}`)),Array.isArray(e.registeredIds)&&e.registeredIds.length&&n.push(`Registered IDs: ${e.registeredIds.join(", ")}`),Array.isArray(e.otherNames)&&e.otherNames.length&&n.push(...e.otherNames.map(r=>`OtherName ${r.oid}: ${$(r.valueHex)??r.valueHex??""}`.trim())),n.length?n:null}function ge(e){if(!e)return null;if(Array.isArray(e))return e.length?e:null;const n=[];if(Array.isArray(e.ocsp)&&e.ocsp.length&&n.push(`OCSP: ${e.ocsp.join(", ")}`),Array.isArray(e.caIssuers)&&e.caIssuers.length&&n.push(`CA Issuers: ${e.caIssuers.join(", ")}`),Array.isArray(e.other)&&e.other.length)for(const t of e.other){const r=t.method??"method";Array.isArray(t.locations)&&t.locations.length&&n.push(`${r}: ${t.locations.join(", ")}`)}return n.length?n:null}function ye(e){if(!e)return null;if(Array.isArray(e))return e.length?e:null;const n=[];return Array.isArray(e.urls)&&e.urls.length&&n.push(`URLs: ${e.urls.join(", ")}`),Array.isArray(e.directoryNames)&&e.directoryNames.length&&n.push(`Directory Names: ${e.directoryNames.join(", ")}`),Array.isArray(e.distributionPoints)&&e.distributionPoints.length&&e.distributionPoints.forEach((t,r)=>{const i=[];Array.isArray(t.urls)&&t.urls.length&&i.push(`URLs: ${t.urls.join(", ")}`),Array.isArray(t.directoryNames)&&t.directoryNames.length&&i.push(`Directory Names: ${t.directoryNames.join(", ")}`),i.length&&n.push(`Point ${r+1} — ${i.join("; ")}`)}),n.length?n:null}function xe(e){if(!e)return null;if(Array.isArray(e))return e.length?e:null;const n=[];if(Array.isArray(e.items)&&e.items.length)for(const t of e.items){const r=Array.isArray(t.qualifiers)&&t.qualifiers.length?` [${t.qualifiers.map(i=>`${i.oid}${i.value?`=${i.value}`:""}`).join(", ")}]`:"";n.push(`${t.oid}${r}`)}return n.length?n:null}function Ne(e){if(!e||typeof e=="string")return null;const n=[];return Array.isArray(e.authorityCertIssuer)&&e.authorityCertIssuer.length&&n.push(`authorityCertIssuer: ${e.authorityCertIssuer.join(", ")}`),e.authorityCertSerialNumber&&n.push(`authorityCertSerialNumber: 0x${String(e.authorityCertSerialNumber).toUpperCase()}`),n.length?n:null}function C(e){return!e||!e.length?null:U(e,!0)}function O(e){return e?typeof e=="string"?e:typeof e=="object"&&e.hex?e.hex:null:null}function ne(e,n={}){if(!e)return null;const t=document.createElement("div");t.className="detail-extension-card__hex";const r=S(e,{summary:n.summary??"Key identifier",bytesPerRow:n.bytesPerRow??16,previewBytes:n.previewBytes??18,threshold:n.threshold??160});return r&&t.append(r),t.childElementCount?t:null}function ve(e){const n=O(e);if(!n)return null;const t=document.createElement("div");t.className="detail-extension-card__content";const r=ne(n,{summary:"Key identifier"});return r&&t.append(r),t.childElementCount?t:null}function Ce(e){if(!e)return null;const n=document.createElement("div");n.className="detail-extension-card__content";let t=!1;const r=typeof e=="string"?e:O(e.keyIdentifier)??O(e),i=ne(r,{summary:"Key identifier"});i&&(n.append(i),t=!0);const s=Ne(e);if(s){const l=C(s);l&&(n.append(l),t=!0)}return t?n:null}function Ee(e){if(e==null)return null;if(e instanceof Node)return e;if(Array.isArray(e))return U(e,!0);if(typeof e=="object"){const n=document.createElement("pre");return n.className="detail-extension-card__raw detail-raw",n.textContent=JSON.stringify(e,null,2),n}return U(e,!0)}function q(e,n="muted"){const t=document.createElement("div");return t.className=`detail-extension-card__message detail-extension-card__message--${n}`,t.textContent=e,t}function W(e){return e?S(e,{summary:"Raw value",previewBytes:18,threshold:200}):null}const Ae={"2.5.29.19":e=>C(me(e)),"2.5.29.15":e=>C(pe(e)),"2.5.29.37":e=>C(he(e)),"2.5.29.17":e=>C(be(e)),"1.3.6.1.5.5.7.1.1":e=>C(ge(e)),"2.5.29.31":e=>C(ye(e)),"2.5.29.32":e=>C(xe(e)),"2.5.29.35":e=>Ce(e),"2.5.29.14":e=>ve(e)};function $e(e){if(!e)return null;if(e.status==="error"){const l=document.createElement("div");l.className="detail-extension-card__content",l.append(q(`Error: ${e.error??"Unknown error"}`,"error"));const a=W(e.rawHex);return a&&l.append(a),l}const n=Ae[e.oid];let t=n?n(e.value,e):null;if(!t&&e.value!==void 0&&e.value!==null&&(t=Ee(e.value)),t)return t;const r=document.createElement("div");r.className="detail-extension-card__content";const i=e.status==="parsed"?"No details available":"Unparsed extension";r.append(q(i,"muted"));const s=W(e.rawHex);return s&&r.append(s),r}function Se(e){const n=document.createElement("div");n.className="detail-extension-card__header";const t=document.createElement("div");t.className="detail-extension-card__title",t.textContent=e.name??"Extension",n.append(t);const r=document.createElement("div");r.className="detail-extension-card__meta";const i=document.createElement("span");if(i.className="detail-extension-card__oid",i.textContent=e.oid,r.append(i),e.critical){const s=document.createElement("span");s.className="detail-extension-flag detail-extension-flag--critical",s.textContent="Critical",r.append(s)}return n.append(r),n}function we(e){if(!e)return null;const n=document.createElement("div");n.className="detail-extension-card",n.append(Se(e));const t=document.createElement("div");t.className="detail-extension-card__body";const r=$e(e);return r?t.append(r):t.append(A()),n.append(t),n}function ie(e){if(!Array.isArray(e)||e.length===0)return null;const n=document.createElement("div");n.className="detail-section detail-section--extensions";const t=document.createElement("h3");t.textContent="Extensions",n.append(t);const r=document.createElement("div");return r.className="detail-extensions",e.map(i=>we(i)).filter(Boolean).forEach(i=>r.append(i)),r.childElementCount?(n.append(r),n):null}function Te(e,n,t,r){if(!e&&!n)return null;const i=[];e?.subjectCommonName&&i.push({label:"Subject",value:e.subjectCommonName}),e?.issuerCommonName&&i.push({label:"Issuer",value:e.issuerCommonName}),t&&i.push({label:"Serial (hex)",value:`0x${t.toUpperCase()}`});const s=n?.notBefore??e?.notBefore??null,l=n?.notAfter??e?.notAfter??null;i.push({label:"Valid from",value:N(s)}),i.push({label:"Valid until",value:_(l,r?.daysUntil,r?.secondsUntil)});const a=B(r);return a&&i.push({label:"Status",value:T(a,{detailed:!0})}),v("Overview",i)}function je(e){return e?.name?e.name.replace(/([A-Z])/g," $1").replace(/^./,n=>n.toUpperCase()).replace(/\bOf\b/g,"of").replace(/\bOr\b/g,"or"):e?.shortName?e.shortName:e?.oid??""}function G(e,n){if(!n)return null;const t=Array.isArray(n.attributes)?n.attributes:[],r=document.createElement("div");r.className="detail-card";const i=document.createElement("div");if(i.className="detail-card__title",i.textContent=e,r.append(i),t.length){const s=document.createElement("dl");s.className="detail-card__pairs",t.forEach(l=>{const a=document.createElement("dt");a.textContent=je(l);const o=document.createElement("dd");o.textContent=l.value,s.append(a,o)}),r.append(s)}return r.childElementCount>1?r:null}function Le(e,n){return!Array.isArray(e)||!n?null:e.find(t=>t&&t.oid===n)??null}function Ue(e){if(!e||e.value===null||e.value===void 0)return null;const{value:n}=e;return typeof n=="string"?n:typeof n=="object"&&typeof n.hex=="string"?n.hex:null}function re(e,n){const t=[],r=G("Subject",e);r&&t.push(r);const i=G("Issuer",n);if(i&&t.push(i),!t.length)return null;const s=document.createElement("div");s.className="detail-section detail-section--composite";const l=document.createElement("h3");l.textContent=t.length===2?"Identity":r?"Subject":"Issuer",s.append(l);const a=document.createElement("div");return a.className="detail-composite-grid",t.forEach(o=>a.append(o)),s.append(a),s}function De(e){if(!e)return null;const n=[],t=e.publicKey??{};if(t.algorithm&&n.push({label:"Public key algorithm",value:I(t.algorithm)}),typeof t.sizeBits=="number"&&Number.isFinite(t.sizeBits)&&n.push({label:"Key size",value:`${t.sizeBits} bits`}),typeof t.exponent=="number"&&Number.isFinite(t.exponent)&&n.push({label:"Exponent",value:t.exponent}),t.curveName||t.curveOid){const s=t.curveName&&t.curveOid&&t.curveName!==t.curveOid?`${t.curveName} (${t.curveOid})`:t.curveName??t.curveOid;n.push({label:"Curve",value:s})}if(t.fingerprints){const s=Object.entries(t.fingerprints).filter(([,a])=>!!a).map(([a,o])=>({label:a.toUpperCase(),value:$(o)??o,valueClass:"detail-inline-pair__value--mono"})),l=D(s);l&&n.push({label:"Public key fingerprints",value:l})}t.modulusHex&&n.push({label:"Modulus",value:S(t.modulusHex,{summary:"Modulus",bitLength:t.sizeBits})}),t.subjectPublicKeyHex&&n.push({label:"Subject public key",value:S(t.subjectPublicKeyHex,{summary:"Subject public key",bitLength:t.sizeBits})});const r=Le(e.extensions,"2.5.29.14"),i=Ue(r);if(i){const s=$(i)??i,l=ee(s)??s;n.push({label:"Subject key identifier",value:l})}if(e.fingerprints){const s=Object.entries(e.fingerprints).filter(([,a])=>!!a).map(([a,o])=>({label:a.toUpperCase(),value:$(o)??o,valueClass:"detail-inline-pair__value--mono"})),l=D(s);l&&n.push({label:"Certificate fingerprints",value:l})}return e.signature&&(n.push({label:"Signature algorithm",value:I(e.signature.algorithm)}),n.push({label:"Signature",value:S(e.signature.valueHex,{summary:"Signature",bitLength:e.signature.bitLength})})),n.length?v("Cryptography",n):null}function _e(e,n){if(!e)return[];const t=[],r=Te(e.summary,e.validity,e.serialNumberHex,n);r&&t.push(r);const i=re(e.subject,e.issuer);i&&t.push(i);const s=v("Details",[{label:"Version",value:e.version?`Version ${e.version} (0x${Math.max(0,e.version-1).toString(16)})`:null},{label:"Serial number",value:de(e.serialNumberHex)}]);s&&t.push(s);const l=De(e);l&&t.push(l);const a=ie(e.extensions);return a&&t.push(a),t}function ke(e,n,t,r,i){if(!e&&!n)return null;const s=[];e?.issuerCommonName&&s.push({label:"Issuer",value:e.issuerCommonName});const l=t?.crlNumber??e?.crlNumber??null;l&&s.push({label:"CRL number",value:l}),t?.baseCRLNumber&&s.push({label:"Base CRL number",value:t.baseCRLNumber});const a=n?.thisUpdate??null,o=n?.nextUpdate??null;s.push({label:"This update",value:N(a)}),s.push({label:"Next update",value:_(o,r?.daysUntil,r?.secondsUntil)});const c=typeof e?.entryCount=="number"?z(e.entryCount):e?.entryCount;c!=null&&s.push({label:"Entries",value:c}),typeof i=="boolean"&&s.push({label:"Type",value:i?"Delta":"Base"});const u=K(r,i);return u&&s.push({label:"Status",value:T(u,{detailed:!0})}),v("Overview",s)}function ze(e){if(!e)return null;const n=[{label:"Total",value:typeof e.count=="number"?z(e.count):e.count}];if(e.count===0)n.push({label:"Sample",value:"No revoked certificates"});else if(Array.isArray(e.sample)&&e.sample.length){const t=e.sample.map(r=>{const i=[];if(r.serialNumberHex){try{const a=BigInt(`0x${r.serialNumberHex}`).toString(10);i.push(a)}catch(a){console.warn("serialNumber decimal conversion failed",a)}i.push(`0x${r.serialNumberHex.toUpperCase()}`)}const s=N(r.revocationDate),l=r.reason?`reason: ${r.reason}`:null;return[i.length?`Serial: ${i.join(" / ")}`:null,s?`Revoked: ${s}`:null,l].filter(Boolean).join(" — ")});n.push({label:"Sample",value:t})}return v("Revoked Certificates",n)}function He(e,n){if(!e)return[];const t=[],r=ke(e.summary,e.validity,e.numbers,n,e.isDelta);r&&t.push(r);const i=re(null,e.issuer);if(i&&t.push(i),e.authorityKeyIdentifier){const a=$(e.authorityKeyIdentifier)??e.authorityKeyIdentifier,o=ee(a)??a,c=v("Authority key identifier",[{label:"Key identifier",value:o}]);c&&t.push(c)}if(e.fingerprints){const a=Object.entries(e.fingerprints).filter(([,c])=>!!c).map(([c,u])=>({label:c.toUpperCase(),value:$(u)??u,valueClass:"detail-inline-pair__value--mono"})),o=D(a);if(o){const c=v("CRL fingerprints",[{label:"Fingerprints",value:o}]);c&&t.push(c)}}if(e.signature){const a=v("Signature",[{label:"Algorithm",value:I(e.signature.algorithm)},{label:"Value",value:S(e.signature.valueHex,{summary:"Signature",bitLength:e.signature.bitLength})}]);a&&t.push(a)}const s=ze(e.entries);s&&t.push(s);const l=ie(e.extensions);return l&&t.push(l),t}function X(e){const n=document.createElement("pre");return n.className="detail-raw",n.textContent=JSON.stringify(e,null,2),n}function Me(e){const n=document.createElement("article");n.className="detail-view";const t=e?.attributes??{};t.objectType&&(n.dataset.type=t.objectType);const r=document.createElement("div");r.className="detail-header";const i=document.createElement("div");i.className="detail-chip-row";const s=t.objectType==="certificate"?"Certificate":t.objectType==="crl"?"Certificate Revocation List":"Object",l=t.objectType==="certificate"?"Certificate":t.objectType==="crl"?t.crl?.isDelta?"Delta CRL":"CRL":"Object",a=t.objectType==="certificate"?"certificate":t.objectType==="crl"?t.crl?.isDelta?"delta":"crl":"neutral",o=R(l,{category:"type",tone:a});o&&i.append(o);let c=null,u=null,p=null;if(t.objectType==="certificate"&&t.certificate){const d=t.certificate.validity?.notAfter??t.certificate.summary?.notAfter??null;c=k(d),p=B(c)}else if(t.objectType==="crl"&&t.crl){const d=t.crl.validity?.nextUpdate??null;u=k(d),p=K(u,t.crl.isDelta)}const m=T(p,{detailed:!1});m&&i.append(m),i.childElementCount&&r.append(i);const b=document.createElement("div");b.className="detail-title",b.textContent=s,r.append(b);let g=null;if(t.objectType==="certificate"?g=t.certificate?.summary?.subjectCommonName??null:t.objectType==="crl"&&(g=t.crl?.summary?.issuerCommonName??null),g){const d=document.createElement("div");d.className="detail-highlight",d.textContent=g,r.append(d)}const h=t.path??(e?.id?`/${e.id}`:null);if(h){const d=document.createElement("div");d.className="detail-subtitle",d.textContent=h,r.append(d)}const x=fe(e);return x&&r.append(x),n.append(r),t.objectType==="certificate"&&t.certificate?_e(t.certificate,c).forEach(y=>n.append(y)):t.objectType==="crl"&&t.crl?He(t.crl,u).forEach(y=>n.append(y)):t.parseError?n.append(v("Parse Error",[{label:"Message",value:t.parseError.message}])??X(t.parseError)):n.append(X(t)),n}function Y(e){if(!Array.isArray(e)||e.length===0)return[];if(e.every(t=>!t.inlineTimezone)){const t=[...new Set(e.map(i=>i.timezone).filter(Boolean))],r=e.map(i=>`${i.label} ${i.text}`);return t.length===1&&(r[r.length-1]=`${r[r.length-1]} (${t[0]})`),r}return e.map(t=>{if(t.inlineTimezone)return`${t.label} ${t.text}`;const r=t.timezone?` ${t.timezone}`:"";return`${t.label} ${t.text}${r}`})}function Ie(e){return e.replace(/^[^/]+\//,"").replace(/\.(crt|crl)$/i,"")}function Re(e){return e==="certificate"?"Certificate":e==="crl"?"Certificate Revocation List":e==="delta-crl"?"Delta CRL":"Object"}function Oe(e){const n=e.summary;if(!n)return{node:null,lines:[]};if(e.type==="certificate"){const t=n.notAfter?k(n.notAfter):null,r=B(t),i=T(r,{detailed:!1}),s=[],l={precision:"day"};if(n.notBefore){const a=E(n.notBefore,null,null,l);if(a)s.push({label:"From",text:a.relativeText?`${a.baseText} (${a.relativeText})`:a.baseText,timezone:a.timezone,inlineTimezone:!1});else{const o=N(n.notBefore,l);o&&s.push({label:"From",text:o,timezone:null,inlineTimezone:!0})}}if(n.notAfter){const a=E(n.notAfter,t?.daysUntil,t?.secondsUntil,l);if(a){const o=a.relativeText?`${a.baseText} (${a.relativeText})`:a.baseText;s.push({label:"Until",text:o,timezone:a.timezone,inlineTimezone:!1})}else{const o=_(n.notAfter,t?.daysUntil,t?.secondsUntil,l)??N(n.notAfter,l);o&&s.push({label:"Until",text:o,timezone:null,inlineTimezone:!0})}}return{node:i,lines:Y(s)}}if(e.type==="crl"||e.type==="delta-crl"){const t=n.nextUpdate?k(n.nextUpdate):null,r=K(t,!!n.isDelta),i=T(r,{detailed:!1}),s=[],l={precision:"day"};if(n.thisUpdate){const a=E(n.thisUpdate,null,null,l);if(a)s.push({label:"Issued",text:a.relativeText?`${a.baseText} (${a.relativeText})`:a.baseText,timezone:a.timezone,inlineTimezone:!1});else{const o=N(n.thisUpdate,l);o&&s.push({label:"Issued",text:o,timezone:null,inlineTimezone:!0})}}if(n.nextUpdate){const a=E(n.nextUpdate,t?.daysUntil,t?.secondsUntil,l);if(a){const o=a.relativeText?`${a.baseText} (${a.relativeText})`:a.baseText;s.push({label:"Next update",text:o,timezone:a.timezone,inlineTimezone:!1})}else{const o=_(n.nextUpdate,t?.daysUntil,t?.secondsUntil,l)??N(n.nextUpdate,l);o&&s.push({label:"Next update",text:o,timezone:null,inlineTimezone:!0})}}return{node:i,lines:Y(s)}}return{node:null,lines:[]}}function P(e){const n=document.createElement("li"),t=e.type?` file-item--${e.type}`:"";n.className=`file-item${t}`;const r=document.createElement("div");r.className="file-main";const i=document.createElement("div");i.className="file-heading";const s=document.createElement("span");s.className="file-badge",s.textContent=e.label??e.type?.toUpperCase()??"Object",i.append(s);const l=document.createElement("span");l.className="detail-title",l.textContent=Re(e.type),i.append(l);const{node:a,lines:o}=Oe(e);if(a&&i.append(a),r.append(i),e.displayName){const f=document.createElement("div");f.className="detail-highlight",f.textContent=e.displayName,r.append(f)}if(o.length){const f=document.createElement("div");f.className="file-meta",f.textContent=o.join(" · "),r.append(f)}const c=document.createElement("div");c.className="file-path",c.textContent=e.baseKey,r.append(c),n.append(r);const u=document.createElement("div");u.className="file-actions";const p=document.createElement("div");if(p.className="file-links",p.setAttribute("aria-label","Available downloads"),e.hasDer&&e.derHref){const f=document.createElement("a");f.className="file-link",f.href=e.derHref,f.textContent="DER",p.append(f)}if(e.hasPem&&e.pemHref){const f=document.createElement("a");f.className="file-link",f.href=e.pemHref,f.textContent="PEM",p.append(f)}u.append(p);const m=document.createElement("button");m.className="btn btn-expand",m.dataset.key=String(e.primaryKey),m.setAttribute("aria-expanded","false");const b=document.createElement("span");b.className="btn-expand-icon",b.setAttribute("aria-hidden","true");const g=document.createElement("span");g.className="btn-expand-label",g.textContent="View details",m.append(b,g),u.append(m);const h=document.createElement("span");h.className="loading",h.setAttribute("hidden",""),h.setAttribute("aria-live","polite");const x=document.createElement("span");x.className="spinner",x.setAttribute("aria-hidden","true");const d=document.createElement("span");d.className="sr-only",d.textContent="Loading…",h.append(x,d),u.append(h),n.append(u);const y=document.createElement("div");return y.className="details detail-container",y.dataset.panel=String(e.primaryKey),y.setAttribute("hidden",""),n.append(y),n}function F(e=[],n,t=[]){const r=new Map;for(const i of e){if(!i||typeof i.key!="string"||t.some(p=>i.key.startsWith(p)))continue;const s=i.key.endsWith(`${n}.pem`),l=i.key.endsWith(n)&&!s;if(!l&&!s)continue;const a=s?i.key.replace(/\.pem$/,""):i.key,o=r.get(a)??{base:a,der:null,pem:null,summary:null,displayName:null,kind:null};s?o.pem=i:o.der=i;const c=i.summary??null;c&&(!o.summary||l)&&(o.summary=c);const u=i.displayName??c?.displayName??c?.subjectCommonName??c?.issuerCommonName??null;u&&(!o.displayName||l)&&(o.displayName=u),!o.kind&&i.type&&(o.kind=i.type),r.set(a,o)}return[...r.entries()].sort(([i],[s])=>i.localeCompare(s)).map(([,i])=>i)}function V(e,n){const t=!!e.der,r=!!e.pem,i=e.der?.key??null,s=e.pem?.key??null,l=i??s??e.base,a=e.summary??e.der?.summary??e.pem?.summary??null,o=a&&n.type==="delta-crl"?{...a,isDelta:a.isDelta??!0}:a,c=e.displayName??Ie(e.base);return{baseKey:e.base,type:n.type,label:n.label,hasDer:t,hasPem:r,derHref:t&&i?`/${i}`:null,pemHref:r&&s?`/${s}`:null,primaryKey:l,summary:o,displayName:c}}function Be(e,n){F(n,".crt").forEach(r=>{const i=V(r,{type:"certificate",label:"Certificate"});e.appendChild(P(i))})}function Ke(e,n){F(n,".crl",["crl/archive/","crl/by-keyid/"]).forEach(r=>{const i=V(r,{type:"crl",label:"CRL"});e.appendChild(P(i))})}function Pe(e,n){F(n,".crl",["dcrl/archive/","dcrl/by-keyid/"]).forEach(r=>{const i=V(r,{type:"delta-crl",label:"Delta CRL"});e.appendChild(P(i))})}function L(e,n){if(!e)return;e.setAttribute("aria-expanded",n?"true":"false"),e.classList.toggle("is-open",n);const t=e.querySelector(".btn-expand-label");t&&(t.textContent=n?"Hide details":"View details")}function se(e){return new Promise(n=>{const t=r=>{r.target!==e||r.propertyName!=="max-height"||(e.removeEventListener("transitionend",t),n())};e.addEventListener("transitionend",t)})}async function M(e){if(!e||!e.hasAttribute("hidden")&&e.classList.contains("is-expanded")&&!e.dataset.animating)return;const n=typeof window<"u"&&window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches;e.dataset.animating="true",e.classList.add("is-transitioning"),e.removeAttribute("hidden");const t=e.scrollHeight;if(!t||n){e.classList.add("is-expanded"),e.classList.remove("is-transitioning"),e.style.maxHeight="",delete e.dataset.animating;return}e.style.maxHeight="0px",e.offsetHeight,e.classList.add("is-expanded"),e.style.maxHeight=`${t}px`,await se(e),e.style.maxHeight="",e.classList.remove("is-transitioning"),delete e.dataset.animating}async function Fe(e){if(!e||e.hasAttribute("hidden")||e.dataset.animating)return;const n=typeof window<"u"&&window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches,t=e.scrollHeight;if(!t||n){e.classList.remove("is-expanded"),e.setAttribute("hidden",""),e.style.maxHeight="",e.classList.remove("is-transitioning"),delete e.dataset.animating;return}e.dataset.animating="true",e.classList.add("is-transitioning"),e.style.maxHeight=`${t}px`,e.offsetHeight,e.classList.remove("is-expanded"),e.style.maxHeight="0px",await se(e),e.setAttribute("hidden",""),e.style.maxHeight="",e.classList.remove("is-transitioning"),delete e.dataset.animating}function Ve(e=document){e.addEventListener("click",async n=>{const t=n.target.closest?.(".btn-expand");if(!t)return;const r=t.getAttribute("data-key"),i=e.querySelector(`.details[data-panel="${r}"]`),s=t.parentElement?.querySelector?.(".loading");if(!(!i||!s)){if(!i.hasAttribute("hidden")){L(t,!1),await Fe(i);return}if(i.getAttribute("data-loaded")==="true"){L(t,!0),await M(i);return}if(i.getAttribute("data-loading")!=="true"){s.removeAttribute("hidden"),t.disabled=!0,i.setAttribute("data-loading","true");try{const l=await le(r);if(i.innerHTML="",l&&typeof l=="object"){const a=Me(l);i.append(a)}else{const a=document.createElement("pre");a.textContent=JSON.stringify(l,null,2),i.append(a)}i.setAttribute("data-loaded","true"),await M(i),L(t,!0)}catch(l){i.innerHTML=`<div class="error">Failed to load details: ${l.message}</div>`,await M(i),L(t,!0)}finally{i.removeAttribute("data-loading"),s.setAttribute("hidden",""),t.disabled=!1}}}})}async function Je(){const e=document.getElementById("certs"),n=document.getElementById("crls"),t=document.getElementById("dcrls");if(!e||!n||!t)return;const[r,i,s]=await Promise.all([H("ca"),H("crl"),H("dcrl")]);Be(e,r?.items??[]),Ke(n,i?.items??[]),Pe(t,s?.items??[])}async function qe(){Ve(document),await Je()}qe().catch(console.error);
